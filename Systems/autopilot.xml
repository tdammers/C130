<?xml version="1.0"?>
<PropertyList>
    <!-- lateral modes -->
    <filter>
        <name>Wing Leveler to Target Roll Deg</name>
        <condition>
            <equals>
                <property>/autopilot/locks/heading</property>
                <value>wing-leveler</value>
            </equals>
        </condition>
        <type>gain</type>
        <gain>1</gain>
        <input><value>0</value></input>
        <output>/autopilot/internal/target-roll-deg</output>
    </filter>
    <filter>
        <name>Heading Bug Error</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <difference>
                    <property>/autopilot/settings/heading-bug-deg</property>
                    <property>/orientation/heading-magnetic-deg</property>
                </difference>
            </expression>
        </input>
        <output>/autopilot/internal/heading-bug-error-deg</output>
        <period>
            <min>-180</min>
            <max>180</max>
        </period>
    </filter>
    <pi-simple-controller>
        <enable>
            <condition>
                <equals>
                    <property>/autopilot/locks/heading</property>
                    <value>dg-heading-hold</value>
                </equals>
            </condition>
        </enable>
        <input>/autopilot/internal/heading-bug-error-deg</input>
        <reference>0</reference>
        <output>/autopilot/internal/target-roll-deg</output>
        <Kp>-2.0</Kp>
        <Ki>-0.02</Ki>
        <min>-30</min>
        <max>30</max>
    </pi-simple-controller>
    <pi-simple-controller>
        <enable>
            <condition>
                <equals>
                    <property>/autopilot/locks/heading</property>
                    <value>true-heading-hold</value>
                </equals>
            </condition>
        </enable>
        <input>/autopilot/internal/true-heading-error-deg</input>
        <reference>0</reference>
        <output>/autopilot/internal/target-roll-deg</output>
        <Kp>-2.0</Kp>
        <Ki>-0.02</Ki>
        <min>-30</min>
        <max>30</max>
    </pi-simple-controller>
    <pid-controller>
        <name>Heading hold</name>
        <debug>false</debug>
        <enable>
            <condition>
                <or>
                    <equals>
                        <property>/autopilot/locks/heading</property>
                        <value>wing-leveler</value>
                    </equals>
                    <equals>
                        <property>/autopilot/locks/heading</property>
                        <value>dg-heading-hold</value>
                    </equals>
                    <equals>
                        <property>/autopilot/locks/heading</property>
                        <value>true-heading-hold</value>
                    </equals>
                </or>
            </condition>
        </enable>
        <input>
            <prop>/orientation/roll-deg</prop>
        </input>
        <reference>
            <prop>/autopilot/internal/target-roll-deg</prop>
        </reference>
        <output>
            <prop>/controls/flight/aileron</prop>
        </output>
        <config>
            <Kp>0.011</Kp>
            <Ti>30.0</Ti>
            <Td>0.0</Td>
            <u_min>-1.0</u_min>
            <u_max>1.0</u_max>
        </config>
    </pid-controller>
    
    <!-- vertical modes -->
    <pid-controller>
        <name>Pitch hold</name>
        <debug>true</debug>
        <enable>
            <prop>/autopilot/locks/altitude</prop>
            <value>pitch-hold</value>
        </enable>
        <input>
            <prop>/orientation/pitch-deg</prop>
        </input>
        <reference>
            <prop>/autopilot/settings/target-pitch-deg</prop>
        </reference>
        <output>
            <prop>/controls/flight/elevator</prop>
        </output>
        <config>
            <Kp>-0.7</Kp>
            <Ti>2.0</Ti>
            <Td>0.1</Td>
            <u_min>-0.5</u_min>
            <u_max>0.5</u_max>
        </config>
    </pid-controller>

    <pid-controller>
        <name>Pitch hold (vertical speed)</name>
        <debug>true</debug>
        <enable>
            <prop>/autopilot/locks/altitude</prop>
            <value>vertical-speed-hold</value>
        </enable>
        <input>
            <prop>/orientation/pitch-deg</prop>
        </input>
        <reference>
            <prop>/autopilot/internal/target-pitch-deg</prop>
        </reference>
        <output>
            <prop>/controls/flight/elevator</prop>
        </output>
        <config>
            <Kp>-0.7</Kp>
            <Ti>2.0</Ti>
            <Td>0.1</Td>
            <u_min>-0.5</u_min>
            <u_max>0.5</u_max>
        </config>
    </pid-controller>
    <pid-controller>
        <name>Vertical speed to target pitch</name>
        <debug>true</debug>
        <enable>
            <prop>/autopilot/locks/altitude</prop>
            <value>vertical-speed-hold</value>
        </enable>
        <input>
            <prop>/velocities/vertical-speed-fps</prop>
            <scale>60.0</scale>
        </input>
        <reference>
            <prop>/autopilot/settings/vertical-speed-fpm</prop>
        </reference>
        <output>
            <prop>/autopilot/internal/target-pitch-deg</prop>
        </output>
        <config>
            <Kp>0.001</Kp>
            <Ti>0.8</Ti>
            <Td>0.0</Td>
            <u_min>-15</u_min>
            <u_max>15</u_max>
        </config>
    </pid-controller>
</PropertyList>
